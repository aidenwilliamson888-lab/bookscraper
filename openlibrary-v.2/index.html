<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® OPEN LIBRARY ¬∑ MASS GENERATOR ¬∑ 1000 BOOKS ¬∑ PREMIUM</title>
    
    <!-- Google Fonts & Font Awesome -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* ROOT VARIABLES */
        :root {
            --primary: #0a1a2a;
            --primary-light: #1e3a4a;
            --primary-dark: #051016;
            --accent: #2e6b8a;
            --accent-light: #4a8baa;
            --success: #1e8b4c;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray-50: #f8fcff;
            --gray-100: #f0f4fa;
            --gray-200: #e2e8f0;
            --gray-300: #d0d8e0;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334e68;
            --gray-800: #1e2a3a;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.02);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.04);
            --shadow-lg: 0 16px 32px rgba(0,0,0,0.06);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 32px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(145deg, var(--gray-100), var(--gray-50));
            padding: 40px 30px;
            color: var(--gray-800);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* HEADER PREMIUM */
        .header {
            background: linear-gradient(145deg, var(--primary), var(--primary-light));
            color: white;
            border-radius: var(--radius-lg);
            padding: 50px 60px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05));
            transform: skewX(-20deg) translateX(100px);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header h1 i {
            color: #f1c40f;
            text-shadow: 0 2px 10px rgba(241,196,15,0.3);
        }

        .header p {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            max-width: 700px;
            margin-bottom: 25px;
        }

        .badge-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badge {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 10px 24px;
            border-radius: 60px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .badge i {
            color: #f1c40f;
        }

        .badge-success {
            background: var(--success);
            border: none;
        }

        /* MAIN GRID */
        .grid-main {
            display: grid;
            grid-template-columns: 1.1fr 1.4fr;
            gap: 35px;
        }

        @media (max-width: 1200px) {
            .grid-main { grid-template-columns: 1fr; }
        }

        /* CARDS PREMIUM */
        .card {
            background: white;
            border-radius: var(--radius-md);
            padding: 35px;
            border: 1px solid rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 20px;
        }

        .card h2 i {
            color: var(--accent);
        }

        /* FORM ELEMENTS */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }

        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--gray-50);
            font-family: 'Inter', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 4px rgba(46,107,138,0.1);
            background: white;
        }

        /* BUTTONS */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn:hover {
            background: var(--primary-light);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(10,26,42,0.2);
        }

        .btn i {
            font-size: 1.2rem;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #156b3a;
        }

        /* STATS CARDS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid var(--gray-200);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* PROGRESS */
        .progress-container {
            background: var(--gray-100);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-top: 25px;
            border: 1px solid var(--gray-200);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--gray-200);
            border-radius: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #27ae60);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 20px;
        }

        /* BOOK GRID PREMIUM */
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 20px;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }

        .book-card {
            background: white;
            border-radius: var(--radius-sm);
            padding: 20px;
            border: 1px solid var(--gray-200);
            transition: var(--transition);
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent);
        }

        .book-cover {
            width: 100%;
            height: 180px;
            object-fit: contain;
            background: var(--gray-100);
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 10px;
        }

        .nocover {
            width: 100%;
            height: 180px;
            background: linear-gradient(145deg, var(--gray-200), var(--gray-300));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            color: var(--gray-600);
            font-size: 0.9rem;
            text-align: center;
            padding: 20px;
            border: 1px dashed var(--gray-400);
        }

        .nocover i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--gray-500);
        }

        .cover-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.65rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .cover-success { background: #e3f2e9; color: var(--success); }
        .cover-warning { background: #fee9e7; color: var(--danger); }

        /* SECTION PREMIUM */
        .premium-section {
            background: linear-gradient(145deg, var(--gray-50), white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 25px;
            margin: 30px 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .section-header i {
            font-size: 1.5rem;
            color: var(--accent);
        }

        .section-header h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* DESCRIPTION PREVIEW */
        .description-preview {
            background: var(--gray-50);
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: var(--radius-sm);
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .description-preview p {
            margin-bottom: 15px;
        }

        .description-preview strong {
            color: var(--primary);
        }

        /* FILENAME EXAMPLE */
        .filename-example {
            background: linear-gradient(145deg, var(--primary), var(--primary-light));
            color: white;
            padding: 16px 24px;
            border-radius: 60px;
            font-family: 'SF Mono', 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .filename-example i {
            color: #f1c40f;
        }

        /* CUSTOM SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* ANIMATIONS */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(46,107,138,0.4); }
            70% { box-shadow: 0 0 0 10px rgba(46,107,138,0); }
            100% { box-shadow: 0 0 0 0 rgba(46,107,138,0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            body { padding: 20px; }
            .header { padding: 30px; }
            .header h1 { font-size: 2rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- HEADER PREMIUM -->
        <div class="header">
            <h1>
                <i class="fas fa-crown"></i>
                OPEN LIBRARY MASS GENERATOR
            </h1>
            <p>
                Generate 1.000+ buku dari 1 keyword ‚Ä¢ Deskripsi premium 7 paragraf ‚Ä¢ SEO Ready ‚Ä¢ Instant Download
            </p>
            <div class="badge-container">
                <span class="badge"><i class="fas fa-check-circle"></i> 100% Working</span>
                <span class="badge"><i class="fas fa-bolt"></i> 1000 Buku/Keyword</span>
                <span class="badge"><i class="fas fa-palette"></i> Premium UI</span>
                <span class="badge badge-success"><i class="fas fa-download"></i> ZIP Siap</span>
            </div>
        </div>

        <!-- MAIN GRID -->
        <div class="grid-main">
            <!-- LEFT PANEL - CONFIGURATION -->
            <div class="card">
                <h2>
                    <i class="fas fa-sliders-h"></i>
                    1. Konfigurasi Massal
                </h2>
                
                <!-- KEYWORD INPUT -->
                <div class="form-group">
                    <label>
                        <i class="fas fa-key"></i>
                        Keyword Utama
                    </label>
                    <input type="text" id="keyword" value="programming python" placeholder="contoh: harry potter, python, fiction, history">
                    <p style="color: var(--gray-600); font-size: 0.9rem; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i>
                        Akan mengambil 1000+ buku dengan pagination otomatis
                    </p>
                </div>

                <!-- DOMAIN -->
                <div class="form-group">
                    <label>
                        <i class="fas fa-globe"></i>
                        Domain
                    </label>
                    <input type="text" id="domain" value="free-ebooks-download.com" placeholder="domainkamu.com">
                </div>

                <!-- TARGET BOOKS -->
                <div class="form-group">
                    <label>
                        <i class="fas fa-book"></i>
                        Target Jumlah Buku
                    </label>
                    <select id="targetBooks">
                        <option value="100">100 buku (cepat)</option>
                        <option value="300">300 buku</option>
                        <option value="500">500 buku</option>
                        <option value="1000" selected>1.000 buku (rekomendasi)</option>
                        <option value="2000">2.000 buku (expert)</option>
                    </select>
                </div>

                <!-- SMARTLINK PREMIUM -->
                <div class="premium-section">
                    <div class="section-header">
                        <i class="fas fa-bolt"></i>
                        <h3>Smartlink Monetisasi</h3>
                    </div>
                    <div class="form-group">
                        <label>üîó Smartlink URL</label>
                        <input type="text" id="smartlink" value="https://adsterra.com/referral/your-id" placeholder="https://your-smartlink.com">
                    </div>
                    <div class="form-group">
                        <label>üì¢ Teks Button</label>
                        <input type="text" id="buttonText" value="üì• Download via Fast Server">
                    </div>
                </div>

                <!-- HISTATS -->
                <div class="premium-section" style="border-left-color: #3498db;">
                    <div class="section-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Histats Tracker</h3>
                    </div>
                    <textarea id="histatsScript" rows="4" style="font-family: monospace;">&lt;!-- Histats.com START --&gt;
&lt;script&gt;
_Hasync.push([&apos;Histats.start&apos;, &apos;1,1234567,4,0,0,0,00000000&apos;]);
_Hasync.push([&apos;Histats.fasi&apos;, &apos;1&apos;]);
(function() {
  var hs = document.createElement(&apos;script&apos;); hs.async = true;
  hs.src = &apos;//s10.histats.com/js15_as.js&apos;;
  document.head.appendChild(hs);
})();
&lt;/script&gt;</textarea>
                </div>

                <!-- ADS SCRIPT -->
                <div class="premium-section" style="border-left-color: #f39c12;">
                    <div class="section-header">
                        <i class="fas fa-ad"></i>
                        <h3>Ads Script</h3>
                    </div>
                    <textarea id="adsScript" rows="3">&lt;div style=&quot;background: #0a1a2a; color: white; padding: 20px; border-radius: 12px; text-align: center;&quot;&gt;
    üì¢ YOUR ADVERTISEMENT HERE
&lt;/div&gt;</textarea>
                </div>

                <!-- GENERATE BUTTON -->
                <button onclick="startMassGeneration()" class="btn" style="background: var(--accent); font-size: 1.2rem; padding: 20px;">
                    <i class="fas fa-magic"></i>
                    GENERATE MASSAL 1.000+ BUKU
                    <i class="fas fa-arrow-right"></i>
                </button>

                <!-- PROGRESS AREA -->
                <div id="progressContainer" class="progress-container" style="display: none;">
                    <div class="progress-header">
                        <span id="progressStatus"><i class="fas fa-spinner fa-spin"></i> Memproses...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
                    </div>
                    <p id="progressDetail" style="margin-top: 15px; color: var(--gray-600);">
                        <i class="fas fa-clock"></i> Memulai generasi...
                    </p>
                </div>

                <!-- FILENAME EXAMPLE -->
                <div id="filenameExample" class="filename-example">
                    <i class="fas fa-file-alt"></i>
                    <span>python-programming-by-john-smith-a7k9f2m1.html</span>
                </div>
            </div>

            <!-- RIGHT PANEL - RESULTS -->
            <div class="card">
                <h2>
                    <i class="fas fa-chart-bar"></i>
                    2. Real-time Statistics
                </h2>

                <!-- STATS GRID -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statTotalBooks">0</div>
                        <div class="stat-label">Total Buku</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statCoverId">0</div>
                        <div class="stat-label">Cover ID</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statCoverEdition">0</div>
                        <div class="stat-label">Cover Edition</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statNoCover">0</div>
                        <div class="stat-label">No Cover</div>
                    </div>
                </div>

                <!-- BOOK GRID PREVIEW -->
                <div style="margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-weight: 700; font-size: 1.1rem;">
                            <i class="fas fa-book-open"></i>
                            Preview Buku
                        </span>
                        <span id="bookCount" style="background: var(--primary); color: white; padding: 6px 20px; border-radius: 60px; font-size: 0.9rem;">
                            0 buku
                        </span>
                    </div>
                    <div id="bookGridPreview" class="book-grid">
                        <div style="grid-column: 1/-1; text-align: center; color: var(--gray-500); padding: 60px;">
                            <i class="fas fa-bolt" style="font-size: 2rem; margin-bottom: 15px;"></i>
                            <p>Klik GENERATE untuk mengambil 1.000+ buku</p>
                        </div>
                    </div>
                </div>

                <!-- DESCRIPTION PREVIEW PREMIUM -->
                <div id="descriptionPreviewSection" style="display: none; margin-top: 25px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <i class="fas fa-quote-right" style="color: var(--accent); font-size: 1.2rem;"></i>
                        <span style="font-weight: 700;">Deskripsi Premium (7 Paragraf)</span>
                    </div>
                    <div id="descriptionPreview" class="description-preview">
                        <!-- Description will appear here -->
                    </div>
                </div>

                <!-- DOWNLOAD BUTTONS -->
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button onclick="downloadAll()" class="btn btn-success" id="downloadBtn" disabled style="flex: 2;">
                        <i class="fas fa-download"></i>
                        üì¶ DOWNLOAD ZIP
                    </button>
                    <button onclick="downloadSitemap()" class="btn" id="sitemapBtn" disabled style="flex: 1; background: var(--accent);">
                        <i class="fas fa-sitemap"></i>
                        SITEMAP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // OPEN LIBRARY MASS GENERATOR - 1000+ BOOKS
        // FOKUS KEYWORD - PREMIUM DESCRIPTION
        // ============================================
        
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const OPEN_LIBRARY_SEARCH = 'https://openlibrary.org/search.json';
        
        // ============================================
        // PREMIUM DESCRIPTION - 7 PARAGRAPH
        // ============================================
        function generatePremiumDescription(book) {
            const title = book.title || 'Untitled';
            const author = book.author_name ? book.author_name[0] : 'Unknown Author';
            const year = book.first_publish_year || (book.publish_year ? book.publish_year[0] : 'Unknown');
            const publisher = book.publisher ? book.publisher[0] : 'Unknown Publisher';
            
            let desc = '';
            
            // PARAGRAPH 1: Main description with required format
            desc += `<p><strong>üìò Download or Read Online ${title} ebook (PDF ePub Mobi) - ${author}, published in ${year} by ${publisher}.</strong> This comprehensive work is available through Open Library's digital collection, offering readers worldwide access to this valuable resource.</p>\n\n`;
            
            // PARAGRAPH 2: First sentence or topic introduction
            if (book.first_sentence) {
                desc += `<p>${book.first_sentence} This opening sets the stage for what promises to be an engaging exploration of the subject matter.</p>\n\n`;
            } else {
                desc += `<p>${title} represents a significant contribution to the field, showcasing ${author}'s expertise and deep understanding of the subject. The book has garnered attention from readers and critics alike for its comprehensive approach.</p>\n\n`;
            }
            
            // PARAGRAPH 3: Subjects/Categories
            if (book.subject && book.subject.length > 0) {
                let subjects = book.subject.slice(0, 7).join(', ');
                desc += `<p><strong>üìö Topics Covered:</strong> This book delves into ${subjects}, providing readers with a thorough understanding of these interconnected themes. Each chapter builds upon the last, creating a cohesive learning experience.</p>\n\n`;
            } else {
                desc += `<p><strong>üìö Content Overview:</strong> The book is structured to guide readers from fundamental concepts to advanced applications. Whether you're new to the subject or looking to deepen your knowledge, this book offers valuable insights at every level.</p>\n\n`;
            }
            
            // PARAGRAPH 4: Author expertise
            desc += `<p><strong>‚úçÔ∏è About the Author:</strong> ${author} brings years of experience and research to this work. Known for their ability to explain complex topics with clarity, ${author} has established themselves as a trusted voice in the field. This book represents the culmination of their expertise and dedication.</p>\n\n`;
            
            // PARAGRAPH 5: What readers will learn
            desc += `<p><strong>üéØ What You'll Learn:</strong> Through ${title}, readers will gain practical knowledge that can be applied immediately. The book covers essential theories, real-world applications, and emerging trends. Each section includes examples and case studies that bring the concepts to life.</p>\n\n`;
            
            // PARAGRAPH 6: Target audience
            desc += `<p><strong>üë• Who This Book Is For:</strong> This book is ideal for students, professionals, and enthusiasts who want to master the subject. The clear explanations make it accessible for beginners, while the depth of content ensures even experienced readers will find new insights. Educators may also find this to be an excellent resource for course material.</p>\n\n`;
            
            // PARAGRAPH 7: Formats and call to action
            desc += `<p><strong>üì± Available Formats:</strong> You can read ${title} online for free through Open Library, or download it in multiple digital formats including PDF, EPUB, and MOBI. These formats are compatible with all major e-readers, tablets, and smartphones. Start reading today and join thousands of readers who have benefited from this remarkable book.</p>`;
            
            return desc;
        }

        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let books = [];
        let coverStats = { coverId: 0, coverEdition: 0, isbn: 0, noCover: 0 };
        let isGenerating = false;

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 8; i++) id += chars.charAt(Math.floor(Math.random() * chars.length));
            return id;
        }

        function generateSlug(title, author) {
            const t = title.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '-').substring(0, 50);
            const a = author.toLowerCase().replace(/[^\w\s]/g, '').replace(/\s+/g, '-').substring(0, 30);
            return `${t}-by-${a}-${generateRandomId()}.html`;
        }

        // ============================================
        // COVER HANDLER - INSTANT FALLBACK
        // ============================================
        function getCoverUrl(doc) {
            if (doc.cover_i) {
                coverStats.coverId++;
                return { url: `https://covers.openlibrary.org/b/id/${doc.cover_i}-L.jpg`, source: 'Cover ID', hasCover: true };
            }
            if (doc.cover_edition_key) {
                coverStats.coverEdition++;
                return { url: `https://covers.openlibrary.org/b/olid/${doc.cover_edition_key}-L.jpg`, source: 'Cover Edition', hasCover: true };
            }
            if (doc.isbn && doc.isbn.length > 0) {
                coverStats.isbn++;
                return { url: `https://covers.openlibrary.org/b/isbn/${doc.isbn[0]}-L.jpg`, source: 'ISBN', hasCover: true };
            }
            coverStats.noCover++;
            return { url: null, source: 'No Cover', hasCover: false };
        }

        // ============================================
        // TITLE FORMATS - RANDOM
        // ============================================
        const TITLE_FORMATS = [
            (t, a) => `[Download] ${t} by ${a}`,
            (t, a) => `[PDF] ${t} by ${a}`,
            (t, a) => `[EPUB] ${t} by ${a}`,
            (t, a) => `[Download PDF] ${t} by ${a}`,
            (t, a) => `[Free Download] ${t} by ${a}`,
            (t, a) => `${t} by ${a} [PDF/EPUB]`
        ];

        // ============================================
        // PROCESS SINGLE BOOK
        // ============================================
        function processBook(doc) {
            const title = doc.title || 'Untitled';
            const author = doc.author_name ? doc.author_name[0] : 'Unknown Author';
            const publisher = doc.publisher ? doc.publisher[0] : 'Unknown Publisher';
            const year = doc.first_publish_year || (doc.publish_year ? doc.publish_year[0] : 'Unknown');
            const coverData = getCoverUrl(doc);
            
            const formatIndex = Math.floor(Math.random() * TITLE_FORMATS.length);
            const formattedTitle = TITLE_FORMATS[formatIndex](title, author);
            const slug = generateSlug(title, author);
            
            return {
                id: generateRandomId(),
                title,
                author,
                publisher,
                year,
                coverUrl: coverData.url,
                coverSource: coverData.source,
                hasCover: coverData.hasCover,
                description: generatePremiumDescription(doc),
                formattedTitle,
                filename: slug,
                olUrl: doc.key ? `https://openlibrary.org${doc.key}` : `https://openlibrary.org/search?q=${encodeURIComponent(title)}`,
                raw: doc
            };
        }

        // ============================================
        // FETCH WITH RETRY & PROXY
        // ============================================
        async function fetchWithProxy(url, retryCount = 0) {
            const proxies = [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            const proxy = proxies[retryCount % proxies.length];
            const proxyUrl = proxy + encodeURIComponent(url);
            
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.text();
            } catch (e) {
                if (retryCount < proxies.length * 2) {
                    await new Promise(r => setTimeout(r, 1000));
                    return fetchWithProxy(url, retryCount + 1);
                }
                throw e;
            }
        }

        // ============================================
        // MASS GENERATION - 1000+ BOOKS
        // ============================================
        async function startMassGeneration() {
            if (isGenerating) {
                alert('Proses generasi sedang berjalan. Tunggu selesai.');
                return;
            }
            
            const keyword = document.getElementById('keyword').value.trim();
            const target = parseInt(document.getElementById('targetBooks').value);
            
            if (!keyword) {
                alert('Masukkan keyword!');
                return;
            }
            
            // Reset state
            isGenerating = true;
            books = [];
            coverStats = { coverId: 0, coverEdition: 0, isbn: 0, noCover: 0 };
            
            // Show progress
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('sitemapBtn').disabled = true;
            document.getElementById('statTotalBooks').innerHTML = '0';
            document.getElementById('bookCount').innerHTML = '0 buku';
            
            // Update progress UI
            document.getElementById('progressStatus').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memulai generasi massal...';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('progressPercent').innerHTML = '0%';
            
            try {
                const PAGE_SIZE = 100;
                const pagesNeeded = Math.ceil(target / PAGE_SIZE);
                let collected = 0;
                
                for (let page = 0; page < pagesNeeded; page++) {
                    if (collected >= target) break;
                    
                    const offset = page * PAGE_SIZE;
                    const url = `${OPEN_LIBRARY_SEARCH}?q=${encodeURIComponent(keyword)}&limit=${PAGE_SIZE}&offset=${offset}`;
                    
                    document.getElementById('progressStatus').innerHTML = `<i class="fas fa-spinner fa-spin"></i> Mengambil halaman ${page + 1}/${pagesNeeded}...`;
                    
                    try {
                        const text = await fetchWithProxy(url);
                        const data = JSON.parse(text);
                        
                        if (!data.docs || data.docs.length === 0) {
                            console.log(`Halaman ${page + 1}: tidak ada buku lagi`);
                            break;
                        }
                        
                        for (const doc of data.docs) {
                            if (collected >= target) break;
                            
                            books.push(processBook(doc));
                            collected++;
                            
                            // Update progress setiap 5 buku
                            if (collected % 5 === 0 || collected === target) {
                                const percent = Math.min(Math.round(collected / target * 100), 100);
                                document.getElementById('progressFill').style.width = percent + '%';
                                document.getElementById('progressPercent').innerHTML = percent + '%';
                                document.getElementById('statTotalBooks').innerHTML = collected;
                                document.getElementById('bookCount').innerHTML = collected + ' buku';
                                
                                // Update cover stats
                                document.getElementById('statCoverId').innerHTML = coverStats.coverId;
                                document.getElementById('statCoverEdition').innerHTML = coverStats.coverEdition;
                                document.getElementById('statNoCover').innerHTML = coverStats.noCover;
                                
                                document.getElementById('progressDetail').innerHTML = 
                                    `<i class="fas fa-book"></i> Mengumpulkan ${collected}/${target} buku... ` +
                                    `(Cover ID: ${coverStats.coverId}, No Cover: ${coverStats.noCover})`;
                            }
                            
                            await new Promise(r => setTimeout(r, 5));
                        }
                        
                        // Delay antar halaman
                        await new Promise(r => setTimeout(r, 500));
                        
                    } catch (e) {
                        console.error(`Error halaman ${page + 1}:`, e);
                        // Lanjut ke halaman berikutnya
                        continue;
                    }
                }
                
                // Selesai
                isGenerating = false;
                document.getElementById('progressStatus').innerHTML = '<i class="fas fa-check-circle"></i> Selesai!';
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressPercent').innerHTML = '100%';
                document.getElementById('statTotalBooks').innerHTML = books.length;
                document.getElementById('bookCount').innerHTML = books.length + ' buku';
                
                // Enable download buttons
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('sitemapBtn').disabled = false;
                
                // Update preview grid
                updatePreviewGrid();
                
                // Update description preview
                if (books.length > 0) {
                    document.getElementById('descriptionPreviewSection').style.display = 'block';
                    document.getElementById('descriptionPreview').innerHTML = books[0].description;
                }
                
                // Update filename example
                if (books.length > 0) {
                    document.getElementById('filenameExample').innerHTML = 
                        `<i class="fas fa-file-alt"></i> ${books[0].filename}`;
                }
                
                document.getElementById('progressDetail').innerHTML = 
                    `<i class="fas fa-check-circle" style="color: var(--success);"></i> ` +
                    `Berhasil mengumpulkan ${books.length} buku! Siap didownload.`;
                
            } catch (e) {
                console.error(e);
                alert('Error: ' + e.message);
                isGenerating = false;
                document.getElementById('progressStatus').innerHTML = '<i class="fas fa-exclamation-circle"></i> Gagal';
                document.getElementById('progressDetail').innerHTML = 'Error: ' + e.message;
            }
        }

        // ============================================
        // UPDATE PREVIEW GRID
        // ============================================
        function updatePreviewGrid() {
            const grid = document.getElementById('bookGridPreview');
            let html = '';
            
            books.slice(0, 12).forEach(book => {
                if (book.hasCover) {
                    html += `<div class="book-card">
                        <img class="book-cover" src="${book.coverUrl}" alt="${book.title}" 
                             onerror="this.src='https://via.placeholder.com/400x600/e2e8f0/4a5a6a?text=No+Cover'">
                        <div style="font-weight: 600; font-size: 0.9rem;">${book.title.substring(0, 35)}...</div>
                        <div style="font-size: 0.8rem; color: var(--gray-600); margin-top: 5px;">${book.author}</div>
                        <span class="cover-badge cover-success">
                            <i class="fas fa-check-circle"></i> ${book.coverSource}
                        </span>
                    </div>`;
                } else {
                    html += `<div class="book-card">
                        <div class="nocover">
                            <i class="fas fa-book"></i>
                            ${book.title.substring(0, 30)}
                            <span style="font-size: 0.7rem; margin-top: 8px;">No Cover Available</span>
                        </div>
                        <div style="font-weight: 600; font-size: 0.9rem; margin-top: 10px;">${book.title.substring(0, 35)}...</div>
                        <div style="font-size: 0.8rem; color: var(--gray-600);">${book.author}</div>
                        <span class="cover-badge cover-warning">
                            <i class="fas fa-exclamation-triangle"></i> No Cover
                        </span>
                    </div>`;
                }
            });
            
            grid.innerHTML = html;
        }

        // ============================================
        // GENERATE LANDING PAGE
        // ============================================
        function generateLandingPage(book, domain, smartlink, btnText, adsScript, histatsScript) {
            const year = new Date().getFullYear();
            const today = new Date().toLocaleDateString('en-US', { day: 'numeric', month: 'long', year: 'numeric' });
            
            let coverHtml = book.hasCover 
                ? `<img src="${book.coverUrl}" alt="${book.title} Cover" style="width:100%; border-radius:16px;" onerror="this.src='https://via.placeholder.com/400x600/e2e8f0/4a5a6a?text=No+Cover'">`
                : `<div style="width:100%; height:100%; min-height:300px; background:linear-gradient(145deg, #e2e8f0, #d0d8e0); 
                    display:flex; flex-direction:column; align-items:center; justify-content:center; border-radius:16px; 
                    color:#334e68; text-align:center; padding:30px; border:2px dashed #94a3b8;">
                    <i class="fas fa-book" style="font-size:3rem; margin-bottom:15px;"></i>
                    <div style="font-weight:600;">${book.title}</div>
                    <div style="font-size:0.9rem; margin-top:10px;">No Cover Available</div>
                  </div>`;
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${book.formattedTitle}</title>
    <meta name="description" content="Download or Read Online ${book.title} ebook (PDF ePub Mobi) - ${book.author}, published in ${book.year}. Free access via Open Library.">
    <link rel="canonical" href="https://${domain}/${book.filename}">
    <meta property="og:title" content="${book.formattedTitle}">
    <meta property="og:description" content="Download or Read Online ${book.title} ebook (PDF ePub Mobi) - ${book.author}, published in ${book.year}.">
    <meta property="og:image" content="${book.hasCover ? book.coverUrl : `https://via.placeholder.com/400x600/e2e8f0/4a5a6a?text=No+Cover`}">
    <meta property="og:url" content="https://${domain}/${book.filename}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #f8fcff; padding: 30px 20px; color: #1e2a3a; }
        .container { max-width: 1100px; margin: 0 auto; }
        .card { background: white; border-radius: 32px; padding: 45px; border: 1px solid #e2e8f0; box-shadow: 0 20px 40px rgba(0,0,0,0.02); }
        .header { display: flex; gap: 40px; margin-bottom: 40px; flex-wrap: wrap; }
        .cover { flex: 0 0 250px; }
        .cover img, .cover div { width: 100%; border-radius: 16px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        h1 { font-size: 2rem; font-weight: 800; margin-bottom: 15px; color: #0a1a2a; line-height: 1.2; }
        .meta { color: #4a5a6a; margin-bottom: 25px; font-size: 1.1rem; }
        .btn { padding: 16px 32px; border-radius: 60px; font-weight: 700; text-decoration: none; display: inline-flex; align-items: center; gap: 12px; transition: 0.2s; flex:1; font-size: 1rem; }
        .btn-primary { background: #0a1a2a; color: white; }
        .btn-primary:hover { background: #1e3a4a; transform: translateY(-3px); box-shadow: 0 15px 30px rgba(10,26,42,0.2); }
        .btn-ads { background: #f39c12; color: white; }
        .btn-ads:hover { background: #e67e22; transform: translateY(-3px); box-shadow: 0 15px 30px rgba(243,156,18,0.2); }
        .button-group { display: flex; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .description { background: #f8fcff; border-radius: 24px; padding: 30px; margin: 40px 0; border-left: 5px solid #0a1a2a; }
        .description p { margin-bottom: 20px; line-height: 1.7; }
        .ads-container { margin: 40px 0; padding: 25px; background: #fff6e5; border-radius: 20px; text-align: center; border: 2px dashed #f39c12; }
        .footer { margin-top: 50px; padding-top: 30px; border-top: 1px solid #ecf1f5; color: #5a6a7a; text-align: center; }
        .id-badge { display: inline-block; background: #0a1a2a; color: white; padding: 6px 20px; border-radius: 60px; font-size: 0.8rem; margin-bottom: 20px; }
        @media (max-width: 768px) { .card { padding: 25px; } .header { flex-direction: column; } h1 { font-size: 1.6rem; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="ads-container" style="margin-top:0;">${adsScript}</div>
            
            <span class="id-badge">
                <i class="fas fa-fingerprint"></i> ID: ${book.id} ¬∑ ${book.coverSource}
            </span>
            
            <div class="header">
                <div class="cover">${coverHtml}</div>
                <div style="flex:1;">
                    <h1>${book.formattedTitle}</h1>
                    <div class="meta">
                        <i class="fas fa-user"></i> <strong>${book.author}</strong> ¬∑ 
                        <i class="fas fa-calendar"></i> ${book.year} ¬∑ 
                        <i class="fas fa-building"></i> ${book.publisher}
                    </div>
                    
                    <div class="button-group">
                        <a href="${book.olUrl}" class="btn btn-primary" target="_blank">
                            <i class="fas fa-book-open"></i> Read at Open Library
                        </a>
                        <a href="${smartlink}" class="btn btn-ads" target="_blank">
                            <i class="fas fa-bolt"></i> ${btnText}
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="description">
                <h2 style="margin-bottom:20px; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-quote-right" style="color:#0a1a2a;"></i> 
                    Book Description
                </h2>
                ${book.description}
            </div>
            
            <div class="ads-container">
                ${adsScript}
            </div>
            
            <div class="footer">
                <p>¬© ${year} ${domain} ¬∑ Free Book Download Portal</p>
                <p style="margin-top:12px; font-size:0.8rem;">
                    <i class="fas fa-database"></i> Source: Open Library ¬∑ 
                    <i class="fas fa-file"></i> ID: ${book.id} ¬∑ 
                    <i class="fas fa-clock"></i> Generated: ${today}
                </p>
            </div>
        </div>
    </div>
    ${histatsScript}
</body>
</html>`;
        }

        // ============================================
        // GENERATE SITEMAP
        // ============================================
        function generateSitemap(books, domain) {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';
            books.forEach(b => {
                xml += `  <url>\n    <loc>https://${domain}/${b.filename}</loc>\n`;
                xml += `    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n`;
                xml += `    <changefreq>monthly</changefreq>\n    <priority>0.7</priority>\n  </url>\n`;
            });
            xml += '</urlset>';
            return xml;
        }

        // ============================================
        // GENERATE INDEX HTML
        // ============================================
        function generateIndexHTML(books, domain) {
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö ${books.length} Free eBooks Download - ${domain}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Inter',sans-serif;background:#f8fcff;padding:40px 20px;color:#1e2a3a;}
        .container{max-width:1200px;margin:0 auto;}
        h1{font-size:2rem;margin-bottom:30px;display:flex;align-items:center;gap:15px;}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:25px;}
        .card{background:white;border-radius:20px;padding:20px;border:1px solid #e2e8f0;transition:0.2s;}
        .card:hover{transform:translateY(-5px);box-shadow:0 15px 30px rgba(0,0,0,0.05);border-color:#0a1a2a;}
        img{width:100%;height:200px;object-fit:contain;margin-bottom:15px;}
        .nocover{width:100%;height:200px;background:#e2e8f0;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;color:#4a5a6a;}
        a{text-decoration:none;color:#0a1a2a;font-weight:600;}
        .btn{display:inline-block;background:#0a1a2a;color:white;padding:10px 24px;border-radius:40px;margin-top:15px;font-size:0.9rem;transition:0.2s;}
        .btn:hover{background:#1e3a4a;}
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-crown" style="color:#f1c40f;"></i> ${books.length} Free eBooks Download</h1>
        <p style="margin-bottom:30px;color:#4a5a6a;">All books are sourced from Open Library. PDF/EPUB formats available.</p>
        <div class="grid">`;
            
            books.slice(0, 50).forEach(b => {
                html += `<div class="card">`;
                if (b.hasCover) {
                    html += `<img src="${b.coverUrl}" onerror="this.src='https://via.placeholder.com/400x600/e2e8f0/4a5a6a?text=No+Cover'">`;
                } else {
                    html += `<div class="nocover"><i class="fas fa-book" style="font-size:2rem; margin-bottom:10px;"></i>No Cover</div>`;
                }
                html += `<h3 style="font-size:0.95rem;">${b.title.substring(0, 50)}${b.title.length > 50 ? '...' : ''}</h3>`;
                html += `<p style="color:#4a5a6a; font-size:0.85rem; margin-top:5px;">${b.author}</p>`;
                html += `<a href="${b.filename}" class="btn"><i class="fas fa-download"></i> Download</a>`;
                html += `</div>`;
            });
            
            html += `</div></body></html>`;
            return html;
        }

        // ============================================
        // DOWNLOAD FUNCTIONS
        // ============================================
        async function downloadAll() {
            if (books.length === 0) {
                alert('Generate dulu!');
                return;
            }
            
            const zip = new JSZip();
            const domain = document.getElementById('domain').value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
            const smartlink = document.getElementById('smartlink').value.trim();
            const btnText = document.getElementById('buttonText').value.trim();
            const adsScript = document.getElementById('adsScript').value;
            const histatsScript = document.getElementById('histatsScript').value;
            
            const folderName = `open-library-${books.length}books`;
            const folder = zip.folder(folderName);
            
            document.getElementById('progressStatus').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Membuat file HTML...';
            
            for (let i = 0; i < books.length; i++) {
                const html = generateLandingPage(books[i], domain, smartlink, btnText, adsScript, histatsScript);
                folder.file(books[i].filename, html);
                
                if (i % 50 === 0) {
                    await new Promise(r => setTimeout(r, 5));
                    const percent = Math.round((i + 1) / books.length * 100);
                    document.getElementById('progressFill').style.width = percent + '%';
                    document.getElementById('progressPercent').innerHTML = percent + '%';
                }
            }
            
            folder.file('sitemap.xml', generateSitemap(books, domain));
            folder.file('index.html', generateIndexHTML(books, domain));
            
            document.getElementById('progressStatus').innerHTML = '<i class="fas fa-download"></i> Downloading ZIP...';
            
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            saveAs(zipBlob, `${folderName}-${Date.now()}.zip`);
            
            document.getElementById('progressStatus').innerHTML = '<i class="fas fa-check-circle"></i> Selesai!';
        }

        function downloadSitemap() {
            if (books.length === 0) {
                alert('Generate dulu!');
                return;
            }
            const domain = document.getElementById('domain').value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
            const sitemap = generateSitemap(books, domain);
            const blob = new Blob([sitemap], { type: 'application/xml' });
            saveAs(blob, `sitemap-${Date.now()}.xml`);
        }
    </script>
</body>
</html>
