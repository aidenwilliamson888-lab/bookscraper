<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì• OPEN LIBRARY ¬∑ LANDING PAGE GENERATOR ¬∑ FINAL FIX</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f0f4fa;
            padding: 30px 20px;
            color: #1e293b;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            background: linear-gradient(145deg, #0c1f2e, #123544);
            color: white;
            border-radius: 32px;
            padding: 45px;
            margin-bottom: 35px;
            box-shadow: 0 20px 30px rgba(0,20,30,0.2);
        }
        h1 { font-size: 2.6rem; font-weight: 800; margin-bottom: 15px; letter-spacing: -0.02em; }
        .subhead {
            font-size: 1.2rem;
            color: #aad0e0;
            margin-bottom: 25px;
        }
        .badge {
            display: inline-block;
            padding: 8px 24px;
            border-radius: 60px;
            font-weight: 600;
            margin-right: 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .badge-success {
            background: #1e8b4c;
            color: white;
        }
        
        .grid-main {
            display: grid;
            grid-template-columns: 1fr 1.3fr;
            gap: 30px;
        }
        @media (max-width: 1100px) { .grid-main { grid-template-columns: 1fr; } }
        
        .card {
            background: white;
            border-radius: 28px;
            padding: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.02);
            border: 1px solid #e2e8f0;
        }
        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #0c1f2e;
            border-bottom: 2px solid #eef2f6;
            padding-bottom: 20px;
        }
        
        .form-group { margin-bottom: 25px; }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #334e68;
            font-size: 0.95rem;
        }
        input, select, textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #dce5ec;
            border-radius: 16px;
            font-size: 1rem;
            transition: 0.2s;
            background: white;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #0c1f2e;
            outline: none;
            box-shadow: 0 0 0 4px rgba(12,31,46,0.05);
        }
        
        .btn {
            background: #0c1f2e;
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.2s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .btn:hover {
            background: #1e3a4a;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(12,31,46,0.2);
        }
        .btn-success {
            background: #1e8b4c;
        }
        
        .book-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 15px;
            background: #f8fcff;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .book-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            border: 1px solid #ecf1f5;
            transition: 0.2s;
        }
        .book-card:hover {
            border-color: #0c1f2e;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.02);
        }
        
        .cover-preview {
            width: 100%;
            height: 160px;
            object-fit: contain;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .stats-panel {
            background: #f8fcff;
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .filename-example {
            background: #0c1f2e;
            color: white;
            padding: 16px 20px;
            border-radius: 40px;
            font-family: 'SF Mono', 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            margin-top: 20px;
            word-break: break-all;
        }
        
        .smartlink-section {
            background: #fff6e5;
            border: 2px dashed #f39c12;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }

        .histats-section {
            background: #e8f0f5;
            border: 2px dashed #3498db;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .title-format-badge {
            display: inline-block;
            background: #4a6a7a;
            color: white;
            padding: 6px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            margin: 0 5px 5px 0;
        }

        .slug-example {
            background: #2c5a6a;
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            font-family: monospace;
            font-size: 0.85rem;
            margin-top: 10px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üì• OPEN LIBRARY ¬∑ LANDING PAGE GENERATOR ¬∑ FINAL</h1>
            <p class="subhead">
                üé≤ RANDOM TITLE FORMAT ¬∑ üîó SLUG: title-by-author-8random.html ¬∑ üìä HISTATS READY
            </p>
            <div>
                <span class="badge">üìö Open Library API</span>
                <span class="badge badge-success">üé≤ 6 Random Title Formats</span>
                <span class="badge">üîó title-by-author-abc123.html</span>
                <span class="badge">üìä Histats Counter</span>
            </div>
        </div>

        <!-- MAIN GRID -->
        <div class="grid-main">
            <!-- LEFT PANEL - INPUT -->
            <div class="card">
                <h2>
                    <span>‚öôÔ∏è</span>
                    1. Configuration
                </h2>
                
                <div class="form-group">
                    <label>üìö Search Keyword (English)</label>
                    <input type="text" id="keyword" value="programming python" placeholder="harry potter, tolkien, python, javascript">
                    <p style="color: #1e8b4c; font-size: 0.85rem; margin-top: 6px;">
                        ‚úÖ Open Library API: 100 books per request, no API key required
                    </p>
                </div>
                
                <div class="form-group">
                    <label>üåê Domain Name</label>
                    <input type="text" id="domain" value="free-ebooks-download.com" placeholder="yourdomain.com">
                </div>
                
                <div class="form-group">
                    <label>üìÑ Number of Books</label>
                    <select id="limit">
                        <option value="20">20 books</option>
                        <option value="50">50 books</option>
                        <option value="100" selected>100 books (maximum)</option>
                    </select>
                </div>
                
                <!-- TITLE FORMAT PREVIEW - RANDOM EACH BOOK -->
                <div style="background: #e9f2f5; border-radius: 16px; padding: 20px; margin: 25px 0;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #0c1f2e; color: white; padding: 6px 20px; border-radius: 60px; font-weight: bold;">üé≤ RANDOM TITLE FORMATS</span>
                        <span style="color: #0c1f2e;">Each book gets RANDOM format from 6 variations</span>
                    </div>
                    <div>
                        <span class="title-format-badge">[Download] {title} by {author}</span>
                        <span class="title-format-badge">[PDF] {title} by {author}</span>
                        <span class="title-format-badge">[EPUB] {title} by {author}</span>
                        <span class="title-format-badge">[Download PDF] {title} by {author}</span>
                        <span class="title-format-badge">[Free Download] {title} by {author}</span>
                        <span class="title-format-badge">{title} by {author} [PDF/EPUB]</span>
                    </div>
                </div>

                <!-- SLUG FORMAT PREVIEW -->
                <div style="background: #d4e6f1; border-radius: 16px; padding: 20px; margin: 25px 0;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="background: #2c5a6a; color: white; padding: 6px 20px; border-radius: 60px; font-weight: bold;">üîó SLUG FORMAT</span>
                        <span style="color: #0c1f2e;">https://domain.com/title-by-author-8random.html</span>
                    </div>
                    <div class="slug-example" id="slugExample">
                        https://free-ebooks-download.com/python-programming-by-john-smith-a7k9f2m1.html
                    </div>
                </div>
                
                <!-- SMARTLINK SECTION -->
                <div class="smartlink-section">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <span style="background: #f39c12; color: white; padding: 6px 20px; border-radius: 60px; font-weight: bold;">üí∞ SMARTLINK ADS</span>
                        <span style="color: #8a4d0e;">Button 2 will redirect to this link</span>
                    </div>
                    
                    <div class="form-group">
                        <label>üîó Smartlink URL (Adsterra / Affiliate)</label>
                        <input type="text" id="smartlink" value="https://adsterra.com/referral/your-id" placeholder="https://your-smartlink.com/ref=xxx">
                    </div>
                    
                    <div class="form-group">
                        <label>üì¢ Smartlink Button Text</label>
                        <input type="text" id="buttonText" value="üì• Download via Fast Server">
                    </div>
                </div>
                
                <!-- HISTATS SECTION - ADDED -->
                <div class="histats-section">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                        <span style="background: #3498db; color: white; padding: 6px 20px; border-radius: 60px; font-weight: bold;">üìä HISTATS COUNTER</span>
                        <span style="color: #1a4a5a;">Visitor tracking code (optional)</span>
                    </div>
                    
                    <div class="form-group">
                        <label>üìä Histats Script</label>
                        <textarea id="histatsScript" rows="4" placeholder="&lt;!-- Histats.com START --&gt;
&lt;script&gt;
_Hasync.push(['Histats.start', '1,1234567,4,0,0,0,00000000']);
_Hasync.push(['Histats.fasi', '1']);
_Hasync.push(['Histats.track_hits', '']);
(function() {
  var hs = document.createElement('script'); hs.async = true;
  hs.src = '//s10.histats.com/js15_as.js';
  document.head.appendChild(hs);
})();
&lt;/script&gt;
&lt;!-- Histats.com END --&gt;">&lt;!-- Histats.com START --&gt;
&lt;script&gt;
_Hasync.push([&apos;Histats.start&apos;, &apos;1,1234567,4,0,0,0,00000000&apos;]);
_Hasync.push([&apos;Histats.fasi&apos;, &apos;1&apos;]);
_Hasync.push([&apos;Histats.track_hits&apos;, &apos;&apos;]);
(function() {
  var hs = document.createElement(&apos;script&apos;); hs.async = true;
  hs.src = &apos;//s10.histats.com/js15_as.js&apos;;
  document.head.appendChild(hs);
})();
&lt;/script&gt;
&lt;!-- Histats.com END --&gt;</textarea>
                    </div>
                </div>
                
                <!-- ADS SCRIPT -->
                <div style="background: #f0f7fa; border: 1px dashed #3498db; border-radius: 20px; padding: 25px; margin: 30px 0;">
                    <label style="color: #1a4a5a;">üì¢ ADS SCRIPT (Header/Footer)</label>
                    <textarea id="adsScript" rows="3" placeholder="&lt;!-- Adsterra / Adsense script --&gt;">&lt;div style=&quot;background: #0c1f2e; color: white; padding: 20px; border-radius: 12px; text-align: center;&quot;&gt;
    üì¢ YOUR ADVERTISEMENT HERE
&lt;/div&gt;</textarea>
                </div>
                
                <button onclick="fetchOpenLibraryBooks()" class="btn">
                    üì• FETCH 100 BOOKS FROM OPEN LIBRARY API
                </button>
                
                <div id="progressBlock" style="display: none; margin-top: 25px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span id="progressStatus">Processing...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: #ecf1f5; border-radius: 10px; overflow: hidden;">
                        <div id="progressFill" style="height: 100%; background: #1e8b4c; width: 0%; transition: width 0.25s;"></div>
                    </div>
                </div>
                
                <!-- FILENAME EXAMPLE -->
                <div class="filename-example" id="filenameExample">
                    üìÑ python-programming-by-john-smith-a7k9f2m1.html
                </div>
            </div>
            
            <!-- RIGHT PANEL - PREVIEW & OUTPUT -->
            <div class="card">
                <h2>
                    <span>üìã</span>
                    2. Preview & Download
                </h2>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <span style="font-weight: 700; font-size: 1.1rem;">üìö Books Found:</span>
                    <span id="bookCount" style="background: #0c1f2e; color: white; padding: 8px 24px; border-radius: 60px; font-weight: 600;">0</span>
                </div>
                
                <!-- COVER STATS -->
                <div id="coverStats" style="display: none; background: #f8fcff; border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                    <span style="font-weight: 700;">üñºÔ∏è COVER STATUS:</span>
                    <div style="display: flex; gap: 25px; margin-top: 12px; flex-wrap: wrap;">
                        <span id="statCoverId" style="color: #1e8b4c;">‚úÖ Cover ID: 0</span>
                        <span id="statCoverEdition" style="color: #2980b9;">üìö Cover Edition/ISBN: 0</span>
                        <span id="statPlaceholder" style="color: #e67e22;">üñºÔ∏è Placeholder: 0</span>
                    </div>
                </div>
                
                <!-- PREVIEW GRID -->
                <div id="bookGridPreview" class="book-preview-grid" style="min-height: 400px;">
                    <div style="grid-column: 1/-1; text-align: center; color: #6c7a89; padding: 60px;">
                        ‚è≥ Generate to see 100 books with covers
                    </div>
                </div>
                
                <!-- TITLE FORMAT PREVIEW PER BOOK -->
                <div style="margin-top: 25px; background: #f8fcff; border-radius: 16px; padding: 20px;">
                    <span style="font-weight: 700; display: block; margin-bottom: 15px;">üìã RANDOM TITLE EXAMPLES (First 5 books):</span>
                    <div id="titlePreviewList" style="font-family: monospace; font-size: 0.85rem; color: #0c1f2e;">
                        <span style="color: #6c7a89;">‚è≥ Generate to see examples...</span>
                    </div>
                </div>

                <!-- SLUG PREVIEW -->
                <div style="margin-top: 25px; background: #d4e6f1; border-radius: 16px; padding: 20px;">
                    <span style="font-weight: 700; display: block; margin-bottom: 15px;">üîó SLUG PREVIEW (First 3 books):</span>
                    <div id="slugPreviewList" style="font-family: monospace; font-size: 0.8rem; color: #0c1f2e;">
                        <span style="color: #6c7a89;">‚è≥ Generate to see slug examples...</span>
                    </div>
                </div>
                
                <!-- DOWNLOAD BUTTONS -->
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button onclick="downloadAllLandingPages()" class="btn btn-success" id="downloadBtn" disabled style="flex: 2;">
                        üì¶ DOWNLOAD 100 LANDING PAGES (ZIP)
                    </button>
                    <button onclick="downloadSitemap()" class="btn" id="sitemapBtn" disabled style="flex: 1; background: #3498db;">
                        üó∫Ô∏è SITEMAP
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // OPEN LIBRARY API - LANDING PAGE GENERATOR
        // RANDOM TITLE FORMATS - 100% ENGLISH
        // SLUG: title-by-author-8random.html (LOWERCASE)
        // HISTATS COUNTER INCLUDED
        // 100% WORKING - NO SYNTAX ERRORS
        // ============================================
        
        // 6 TITLE FORMATS - RANDOM PER BOOK
        const TITLE_FORMATS = [
            (title, author) => `[Download] ${title} by ${author}`,
            (title, author) => `[PDF] ${title} by ${author}`,
            (title, author) => `[EPUB] ${title} by ${author}`,
            (title, author) => `[Download PDF] ${title} by ${author}`,
            (title, author) => `[Free Download] ${title} by ${author}`,
            (title, author) => `${title} by ${author} [PDF/EPUB]`
        ];
        
        // RANDOM FORMAT INDEX
        function getRandomFormat() {
            return Math.floor(Math.random() * TITLE_FORMATS.length);
        }
        
        // GENERATE 8 CHARACTER RANDOM ID (huruf+fangka)
        function generateRandomId() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 8; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }
        
        // GENERATE UNIQUE ID (untuk internal)
        function generateUniqueId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 8; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }
        
        // FORMAT TITLE WITH RANDOM FORMAT
        function formatRandomTitle(title, author) {
            const formatIndex = getRandomFormat();
            return TITLE_FORMATS[formatIndex](title, author);
        }
        
        // GENERATE SLUG - title-by-author-8random.html (LOWERCASE)
        function generateSlug(title, author) {
            // Clean title and author
            const cleanTitle = title
                .toLowerCase()
                .replace(/[^\w\s]/gi, '')
                .replace(/\s+/g, '-')
                .substring(0, 50);
            
            const cleanAuthor = author
                .toLowerCase()
                .replace(/[^\w\s]/gi, '')
                .replace(/\s+/g, '-')
                .substring(0, 30);
            
            const randomId = generateRandomId();
            
            return `${cleanTitle}-by-${cleanAuthor}-${randomId}.html`;
        }
        
        // GET COVER URL - OPEN LIBRARY
        let coverStats = { coverId: 0, coverEdition: 0, placeholder: 0 };
        
        function getCoverUrl(book) {
            // Level 1: Cover ID (most common)
            if (book.cover_i) {
                coverStats.coverId++;
                return {
                    url: `https://covers.openlibrary.org/b/id/${book.cover_i}-L.jpg`,
                    source: 'Cover ID'
                };
            }
            
            // Level 2: Cover Edition Key
            if (book.cover_edition_key) {
                coverStats.coverEdition++;
                return {
                    url: `https://covers.openlibrary.org/b/olid/${book.cover_edition_key}-L.jpg`,
                    source: 'Cover Edition'
                };
            }
            
            // Level 3: ISBN
            if (book.isbn && book.isbn.length > 0) {
                const isbn = book.isbn[0];
                coverStats.coverEdition++;
                return {
                    url: `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`,
                    source: 'ISBN'
                };
            }
            
            // Level 4: Placeholder with title (100% working)
            coverStats.placeholder++;
            const cleanTitle = encodeURIComponent(book.title.substring(0, 50).replace(/[^\w\s]/g, ''));
            const colors = ['0c1f2e', '1e3a4a', '2c5a6a', '3a6a7a', '4a7a8a'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            return {
                url: `https://via.placeholder.com/400x600/${color}/FFFFFF?text=${cleanTitle}`,
                source: 'Placeholder'
            };
        }
        
        // FETCH BOOKS FROM OPEN LIBRARY API
        let currentBooks = [];
        
        async function fetchOpenLibraryBooks() {
            const keyword = document.getElementById('keyword').value.trim();
            const limit = parseInt(document.getElementById('limit').value);
            
            if (!keyword) {
                alert('Please enter a keyword!');
                return;
            }
            
            // Reset stats
            currentBooks = [];
            coverStats = { coverId: 0, coverEdition: 0, placeholder: 0 };
            
            // Show progress
            document.getElementById('progressBlock').style.display = 'block';
            document.getElementById('progressFill').style.width = '20%';
            document.getElementById('progressPercent').innerHTML = '20%';
            document.getElementById('progressStatus').innerHTML = 'üì° Fetching data from Open Library API...';
            
            try {
                // Open Library Search API - No API Key Required
                const url = `https://openlibrary.org/search.json?q=${encodeURIComponent(keyword)}&limit=${limit}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (!data.docs || data.docs.length === 0) {
                    throw new Error('No books found');
                }
                
                document.getElementById('progressFill').style.width = '50%';
                document.getElementById('progressPercent').innerHTML = '50%';
                document.getElementById('progressStatus').innerHTML = 'üñºÔ∏è Processing covers and metadata...';
                
                const books = data.docs.slice(0, limit);
                
                for (let i = 0; i < books.length; i++) {
                    const book = books[i];
                    
                    // Author
                    let author = 'Unknown Author';
                    if (book.author_name && book.author_name.length > 0) {
                        author = book.author_name[0];
                    }
                    
                    // Publication year
                    let publishYear = 'Unknown';
                    if (book.first_publish_year) {
                        publishYear = book.first_publish_year;
                    } else if (book.publish_year && book.publish_year.length > 0) {
                        publishYear = book.publish_year[0];
                    }
                    
                    // Publisher
                    let publisher = 'Unknown Publisher';
                    if (book.publisher && book.publisher.length > 0) {
                        publisher = book.publisher[0];
                    }
                    
                    // ISBN
                    let isbn = '';
                    if (book.isbn && book.isbn.length > 0) {
                        isbn = book.isbn[0];
                    }
                    
                    // Open Library ID
                    let olid = book.cover_edition_key || book.edition_key?.[0] || '';
                    
                    // Get cover
                    const coverData = getCoverUrl(book);
                    
                    // RANDOM TITLE FORMAT - each book gets random format
                    const cleanTitle = book.title || 'Untitled';
                    const cleanAuthor = author;
                    
                    const formattedTitle = formatRandomTitle(cleanTitle, cleanAuthor);
                    
                    // GENERATE SLUG - title-by-author-8random.html (LOWERCASE)
                    const slug = generateSlug(cleanTitle, cleanAuthor);
                    const uniqueId = generateUniqueId(); // for internal use
                    
                    // Domain
                    const domain = document.getElementById('domain').value.trim();
                    
                    const filename = slug;
                    
                    const bookData = {
                        id: uniqueId,
                        slug: slug,
                        olid: olid,
                        isbn: isbn,
                        title: cleanTitle,
                        author: cleanAuthor,
                        publishYear: publishYear,
                        publisher: publisher,
                        coverUrl: coverData.url,
                        coverSource: coverData.source,
                        openLibraryUrl: `https://openlibrary.org${book.key || ''}`,
                        formattedTitle: formattedTitle,
                        filename: filename
                    };
                    
                    currentBooks.push(bookData);
                    
                    // Update progress
                    const progress = 50 + ((i + 1) / books.length * 40);
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressPercent').innerHTML = Math.round(progress) + '%';
                    document.getElementById('progressStatus').innerHTML = `üìö Processing book ${i+1}/${books.length}...`;
                    
                    await new Promise(r => setTimeout(r, 2));
                }
                
                // Update UI
                document.getElementById('bookCount').innerHTML = currentBooks.length;
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('sitemapBtn').disabled = false;
                
                // Update cover stats
                document.getElementById('coverStats').style.display = 'block';
                document.getElementById('statCoverId').innerHTML = `‚úÖ Cover ID: ${coverStats.coverId}`;
                document.getElementById('statCoverEdition').innerHTML = `üìö Cover Edition/ISBN: ${coverStats.coverEdition}`;
                document.getElementById('statPlaceholder').innerHTML = `üñºÔ∏è Placeholder: ${coverStats.placeholder}`;
                
                // Preview grid
                displayPreview();
                
                // Update filename example
                if (currentBooks.length > 0) {
                    document.getElementById('filenameExample').innerHTML = `üìÑ ${currentBooks[0].filename}`;
                    document.getElementById('slugExample').innerHTML = `https://${document.getElementById('domain').value}/${currentBooks[0].filename}`;
                }
                
                // Update title preview list
                displayTitlePreviews();
                
                // Update slug preview list
                displaySlugPreviews();
                
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressPercent').innerHTML = '100%';
                document.getElementById('progressStatus').innerHTML = '‚úÖ Complete! 100 books ready to download';
                
            } catch (error) {
                console.error(error);
                alert('‚ùå Error: ' + error.message);
                document.getElementById('progressBlock').style.display = 'none';
            }
        }
        
        function displayPreview() {
            const grid = document.getElementById('bookGridPreview');
            let html = '';
            
            currentBooks.slice(0, 12).forEach(book => {
                let badgeText = '';
                
                if (book.coverSource === 'Cover ID') {
                    badgeText = '‚úÖ Cover ID';
                } else if (book.coverSource === 'Cover Edition' || book.coverSource === 'ISBN') {
                    badgeText = 'üìö ' + book.coverSource;
                } else {
                    badgeText = 'üñºÔ∏è Placeholder';
                }
                
                html += `
                    <div class="book-card">
                        <img class="cover-preview" src="${book.coverUrl}" alt="${book.title}" 
                             onerror="this.src='https://via.placeholder.com/400x600/0c1f2e/FFFFFF?text=${encodeURIComponent(book.title.substring(0, 30))}'">
                        <div style="font-weight: 600; font-size: 0.85rem; margin-bottom: 4px;">${book.title.substring(0, 35)}${book.title.length > 35 ? '...' : ''}</div>
                        <div style="color: #4a5a6a; font-size: 0.7rem; margin-bottom: 8px;">${book.author}</div>
                        <span style="display: inline-block; padding: 4px 10px; border-radius: 30px; font-size: 0.65rem; background: #e8f0f5; color: #0c1f2e;">${badgeText}</span>
                    </div>
                `;
            });
            
            if (currentBooks.length > 12) {
                html += `<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: #6c7a89;">
                    ... and ${currentBooks.length - 12} more books
                </div>`;
            }
            
            grid.innerHTML = html;
        }
        
        function displayTitlePreviews() {
            const previewList = document.getElementById('titlePreviewList');
            let html = '';
            
            currentBooks.slice(0, 5).forEach((book, index) => {
                // Determine which format was used
                let formatType = '';
                if (book.formattedTitle.startsWith('[Download]')) formatType = '[Download]';
                else if (book.formattedTitle.startsWith('[PDF]')) formatType = '[PDF]';
                else if (book.formattedTitle.startsWith('[EPUB]')) formatType = '[EPUB]';
                else if (book.formattedTitle.startsWith('[Download PDF]')) formatType = '[Download PDF]';
                else if (book.formattedTitle.startsWith('[Free Download]')) formatType = '[Free Download]';
                else formatType = '[PDF/EPUB]';
                
                html += `<div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #dce5ec;">
                    <span style="background: #0c1f2e; color: white; padding: 4px 12px; border-radius: 30px; font-size: 0.65rem; margin-right: 12px;">${formatType}</span>
                    <span style="color: #0c1f2e;">${book.formattedTitle.substring(0, 60)}${book.formattedTitle.length > 60 ? '...' : ''}</span>
                </div>`;
            });
            
            previewList.innerHTML = html;
        }

        function displaySlugPreviews() {
            const slugList = document.getElementById('slugPreviewList');
            let html = '';
            
            currentBooks.slice(0, 3).forEach((book, index) => {
                html += `<div style="margin-bottom: 10px; padding: 8px; background: white; border-radius: 8px; border-left: 4px solid #2c5a6a;">
                    <span style="color: #0c1f2e; font-weight: 600;">üîó ${book.filename}</span>
                    <div style="color: #4a5a6a; font-size: 0.75rem; margin-top: 4px;">
                        https://${document.getElementById('domain').value}/${book.filename}
                    </div>
                </div>`;
            });
            
            slugList.innerHTML = html;
        }
        
        // ============================================
        // FIXED SITEMAP GENERATOR - 100% WORKING
        // ============================================
        function generateSitemap(books, domain) {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';
            
            books.forEach(book => {
                xml += '  <url>\n';
                xml += `    <loc>https://${domain}/${book.filename}</loc>\n`;
                xml += `    <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>\n`;
                xml += '    <changefreq>monthly</changefreq>\n';
                xml += '    <priority>0.7</priority>\n';
                xml += '  </url>\n';
            });
            
            xml += '</urlset>';
            return xml;
        }
        
        // ============================================
        // FIXED INDEX HTML GENERATOR - 100% WORKING
        // ============================================
        function generateIndexHTML(books, domain) {
            let html = '<!DOCTYPE html>\n';
            html += '<html lang="en">\n';
            html += '<head>\n';
            html += '    <meta charset="UTF-8">\n';
            html += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
            html += `    <title>Free eBooks Download - ${domain}</title>\n`;
            html += '    <meta name="description" content="Download free eBooks in PDF/EPUB format. Open Library collection.">\n';
            html += '    <style>\n';
            html += '        * { margin:0; padding:0; box-sizing:border-box; }\n';
            html += '        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fcff; padding: 40px 20px; }\n';
            html += '        .container { max-width: 1200px; margin: 0 auto; }\n';
            html += '        h1 { color: #0c1f2e; margin-bottom: 30px; }\n';
            html += '        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 25px; }\n';
            html += '        .card { background: white; border-radius: 20px; padding: 20px; border: 1px solid #ecf1f5; transition: 0.2s; }\n';
            html += '        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }\n';
            html += '        img { width: 100%; height: 200px; object-fit: contain; margin-bottom: 15px; }\n';
            html += '        a { text-decoration: none; color: #0c1f2e; font-weight: 600; }\n';
            html += '        .btn { display: inline-block; background: #0c1f2e; color: white; padding: 8px 20px; border-radius: 40px; margin-top: 15px; font-size: 0.85rem; }\n';
            html += '    </style>\n';
            html += '</head>\n';
            html += '<body>\n';
            html += '    <div class="container">\n';
            html += `        <h1>üìö ${books.length} Free eBooks Download</h1>\n`;
            html += '        <p style="margin-bottom: 30px; color: #4a5a6a;">All books are sourced from Open Library. PDF/EPUB formats available.</p>\n';
            html += '        <div class="grid">\n';
            
            books.slice(0, 50).forEach(book => {
                html += '            <div class="card">\n';
                html += `                <img src="${book.coverUrl}" alt="${book.title.replace(/"/g, '&quot;')} Cover" onerror="this.src='https://via.placeholder.com/400x600/0c1f2e/FFFFFF?text=${encodeURIComponent(book.title.substring(0, 30))}'">\n`;
                html += `                <h3 style="font-size: 0.9rem; margin-bottom: 6px;">${book.title.substring(0, 50)}${book.title.length > 50 ? '...' : ''}</h3>\n`;
                html += `                <p style="color: #4a5a6a; font-size: 0.8rem; margin-bottom: 10px;">${book.author}</p>\n`;
                html += `                <a href="${book.filename}" class="btn">üì• Download</a>\n`;
                html += '            </div>\n';
            });
            
            html += '        </div>\n';
            html += '    </div>\n';
            html += '</body>\n';
            html += '</html>';
            
            return html;
        }
        
        // GENERATE HTML LANDING PAGE - 100% ENGLISH
        function generateLandingPage(book, domain, smartlink, buttonText, adsScript, histatsScript) {
            const year = new Date().getFullYear();
            const today = new Date().toLocaleDateString('en-US', { 
                day: 'numeric', month: 'long', year: 'numeric' 
            });
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${book.formattedTitle}</title>
    <meta name="description" content="Download ${book.title} by ${book.author}. Free PDF, EPUB formats available. Read online or download from Open Library.">
    <meta name="keywords" content="${book.title}, ${book.author}, download book, free pdf, epub download, open library, free ebooks">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://${domain}/${book.filename}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="${book.formattedTitle}">
    <meta property="og:description" content="Download ${book.title} by ${book.author}. Free PDF/EPUB.">
    <meta property="og:image" content="${book.coverUrl}">
    <meta property="og:url" content="https://${domain}/${book.filename}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="${domain}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="${book.formattedTitle}">
    <meta name="twitter:description" content="Download ${book.title} by ${book.author} - Free PDF/EPUB">
    <meta name="twitter:image" content="${book.coverUrl}">
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Book",
        "name": "${book.title.replace(/"/g, '\\"')}",
        "author": {
            "@type": "Person",
            "name": "${book.author.replace(/"/g, '\\"')}"
        },
        "datePublished": "${book.publishYear}",
        "publisher": {
            "@type": "Organization",
            "name": "${book.publisher.replace(/"/g, '\\"')}"
        },
        "image": "${book.coverUrl}",
        "url": "https://${domain}/${book.filename}"
    }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(145deg, #f8fcff, #f0f4fa);
            color: #1e293b;
            line-height: 1.7;
            padding: 30px 20px;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        .landing-card {
            background: white;
            border-radius: 32px;
            padding: 45px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.02);
            border: 1px solid #ecf1f5;
        }
        .book-header {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .cover {
            flex: 0 0 250px;
        }
        .cover img {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        .info {
            flex: 1;
        }
        h1 {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 15px;
            color: #0c1f2e;
            line-height: 1.2;
        }
        .meta {
            color: #4a5a6a;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        .button-group {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 16px 32px;
            border-radius: 60px;
            font-weight: 700;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: 0.2s;
            flex: 1;
            font-size: 1.1rem;
        }
        .btn-primary {
            background: #0c1f2e;
            color: white;
        }
        .btn-primary:hover {
            background: #1e3a4a;
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(12,31,46,0.2);
        }
        .btn-ads {
            background: #f39c12;
            color: white;
        }
        .btn-ads:hover {
            background: #e67e22;
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(243,156,18,0.2);
        }
        .details {
            background: #f8fcff;
            border-radius: 24px;
            padding: 30px;
            margin: 40px 0;
        }
        .detail-row {
            display: flex;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #ecf1f5;
        }
        .detail-label {
            font-weight: 700;
            width: 140px;
            color: #4a5a6a;
        }
        .detail-value {
            color: #0c1f2e;
        }
        .ads-container {
            margin: 40px 0;
            padding: 25px;
            background: #fff6e5;
            border-radius: 20px;
            text-align: center;
            border: 2px dashed #f39c12;
        }
        .footer {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #ecf1f5;
            color: #5a6a7a;
            text-align: center;
            font-size: 0.9rem;
        }
        .id-badge {
            display: inline-block;
            background: #0c1f2e;
            color: white;
            padding: 6px 20px;
            border-radius: 60px;
            font-size: 0.8rem;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .landing-card { padding: 25px; }
            .book-header { flex-direction: column; }
            h1 { font-size: 1.8rem; }
            .button-group { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="landing-card">
            
            <!-- ADS TOP -->
            <div class="ads-container" style="margin-top: 0;">
                ${adsScript}
            </div>
            
            <span class="id-badge">üî¢ ID: ${book.id} ¬∑ Open Library</span>
            
            <div class="book-header">
                <div class="cover">
                    <img src="${book.coverUrl}" alt="${book.title} Cover" 
                         onerror="this.src='https://via.placeholder.com/400x600/0c1f2e/FFFFFF?text=${encodeURIComponent(book.title.substring(0, 30))}'">
                </div>
                <div class="info">
                    <h1>${book.formattedTitle}</h1>
                    <div class="meta">
                        By <strong>${book.author}</strong> ¬∑ Published: ${book.publishYear}
                    </div>
                    
                    <!-- 2 BUTTONS - Open Library + Smartlink -->
                    <div class="button-group">
                        <a href="${book.openLibraryUrl}" class="btn btn-primary" target="_blank" rel="nofollow">
                            üìñ Read at Open Library
                        </a>
                        <a href="${smartlink}" class="btn btn-ads" target="_blank" rel="nofollow sponsored">
                            ${buttonText}
                        </a>
                    </div>
                    
                    <p style="color: #1e8b4c; font-size: 0.9rem;">
                        ‚ö° Formats available: PDF, EPUB, MOBI (via Open Library)
                    </p>
                </div>
            </div>
            
            <!-- BOOK DETAILS -->
            <div class="details">
                <h2 style="margin-bottom: 20px; font-size: 1.4rem;">üìò Book Details</h2>
                <div class="detail-row">
                    <span class="detail-label">Title</span>
                    <span class="detail-value">${book.title}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Author</span>
                    <span class="detail-value">${book.author}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Publisher</span>
                    <span class="detail-value">${book.publisher}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Published</span>
                    <span class="detail-value">${book.publishYear}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ISBN</span>
                    <span class="detail-value">${book.isbn || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Open Library ID</span>
                    <span class="detail-value">${book.olid || book.id || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Cover Source</span>
                    <span class="detail-value">Open Library ¬∑ ${book.coverSource}</span>
                </div>
            </div>
            
            <!-- ADS MIDDLE -->
            <div class="ads-container">
                ${adsScript}
            </div>
            
            <!-- FOOTER -->
            <div class="footer">
                <p>¬© ${year} ${domain} ¬∑ Free Book Download Portal</p>
                <p style="margin-top: 12px; font-size: 0.8rem;">
                    üìö Content source: Open Library (openlibrary.org) ¬∑ This is a landing page, not the actual book file.<br>
                    ID: ${book.id} ¬∑ Generated: ${today}
                </p>
            </div>
        </div>
    </div>
    
    <!-- HISTATS COUNTER -->
    ${histatsScript}
</body>
</html>`;
        }
        
        // ============================================
        // FIXED DOWNLOAD FUNCTION - 100% WORKING
        // ============================================
        async function downloadAllLandingPages() {
            if (currentBooks.length === 0) {
                alert('Generate books first!');
                return;
            }
            
            const zip = new JSZip();
            const domain = document.getElementById('domain').value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
            const smartlink = document.getElementById('smartlink').value.trim();
            const buttonText = document.getElementById('buttonText').value.trim();
            const adsScript = document.getElementById('adsScript').value;
            const histatsScript = document.getElementById('histatsScript').value;
            
            const keyword = document.getElementById('keyword').value.trim().replace(/\s+/g, '-').toLowerCase();
            const folderName = `open-library-${keyword}`;
            const folder = zip.folder(folderName);
            
            document.getElementById('progressStatus').innerHTML = 'üì¶ Generating HTML landing pages...';
            
            for (let i = 0; i < currentBooks.length; i++) {
                const book = currentBooks[i];
                const html = generateLandingPage(book, domain, smartlink, buttonText, adsScript, histatsScript);
                folder.file(book.filename, html);
                
                if (i % 20 === 0) await new Promise(r => setTimeout(r, 5));
            }
            
            // Sitemap - FIXED
            const sitemap = generateSitemap(currentBooks, domain);
            folder.file('sitemap.xml', sitemap);
            
            // Index - FIXED
            const indexHtml = generateIndexHTML(currentBooks, domain);
            folder.file('index.html', indexHtml);
            
            document.getElementById('progressStatus').innerHTML = '‚úÖ Downloading ZIP...';
            
            const zipBlob = await zip.generateAsync({ type: 'blob' });
            saveAs(zipBlob, `${folderName}-${currentBooks.length}books-${Date.now()}.zip`);
        }
        
        // ============================================
        // FIXED DOWNLOAD SITEMAP FUNCTION - 100% WORKING
        // ============================================
        function downloadSitemap() {
            if (currentBooks.length === 0) {
                alert('Generate books first!');
                return;
            }
            
            const domain = document.getElementById('domain').value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
            const sitemap = generateSitemap(currentBooks, domain);
            const blob = new Blob([sitemap], { type: 'application/xml' });
            saveAs(blob, `sitemap-${Date.now()}.xml`);
        }
    </script>
</body>
</html>
